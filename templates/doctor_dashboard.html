{% extends 'base.html' %}
{% block content %}

<h3>Doctor Dashboard</h3>

<!-- ========================= -->
<!-- Doctor Information -->
<!-- ========================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
  <h5 class="mb-0">Doctor Information</h5>
{% if doctor.google_token %}
  <a href="{% url 'google_disconnect' %}"
     class="btn btn-sm btn-light"
     onclick="return confirm('Disconnect Google Calendar?')">
    <i class="bi bi-x-circle"></i> Disconnect Google Calendar
  </a>
{% else %}
  <a href="{% url 'google_login' %}" class="btn btn-sm btn-light">
    <i class="bi bi-google"></i> Connect Google Calendar
  </a>
{% endif %}
</div>



  

  <div class="card-body">
    <div class="row">

      <div class="col-md-6 mb-2">
        <strong>Full Name:</strong><br>
        Dr. {{ doctor.first_name }} {{ doctor.last_name }}
      </div>

      <div class="col-md-6 mb-2">
        <strong>Email:</strong><br>
        {{ doctor.email }}
      </div>

      <div class="col-md-6 mb-2">
        <strong>Contact:</strong><br>
        {{ doctor.contact }}
      </div>

      <div class="col-md-6 mb-2">
        <strong>Gender:</strong><br>
        {{ doctor.gender|title }}
      </div>

      <div class="col-md-6 mb-2">
        <strong>Specialty:</strong><br>
        {% if doctor.specialty %}
          {{ doctor.specialty }}
        {% else %}
          <span class="text-muted">Not specified</span>
        {% endif %}
      </div>

      <div class="col-md-6 mb-2">
        <strong>Experience:</strong><br>
        {% if doctor.years_of_experience %}
          {{ doctor.years_of_experience }} years
        {% else %}
          <span class="text-muted">Not specified</span>
        {% endif %}
      </div>

    </div>
  </div>
</div>



<!-- ========================= -->
<!-- Manage Availabilities -->          
<!-- ========================= -->

<h4>Manage Availabilities</h4>

<a href="/doctor/add/" class="btn btn-primary mb-3">Add Availability</a>

<table class="table table-bordered">
<tr>
    <th>Date</th>
    <th>Time</th>
    <th>Status</th>
</tr>

{% for slot in availabilities %}
<tr>
    <td>{{ slot.date }}</td>
    <td>{{ slot.start_time }} - {{ slot.end_time }}</td>
    <td>
        {% if slot.is_booked %}
            <span class="text-danger">Booked</span>
        {% else %}
            <span class="text-success">Available</span>
        {% endif %}
    </td>
    <td>
  {% if not slot.is_booked %}
    <a href="{% url 'edit_availability' slot.id %}" class="btn btn-sm btn-warning">
      Edit
    </a>
    <a href="{% url 'delete_availability' slot.id %}"
       class="btn btn-sm btn-danger"
       onclick="return confirm('Delete this slot?')">
      Delete
    </a>
  {% else %}
    <span class="text-muted">Locked</span>
  {% endif %}
</td>
</tr>
 {% empty %}
      <tr>
        <td colspan="3" class="text-center text-muted">
          No records found
        </td>
      </tr>
{% endfor %}
</table>


<!-- ========================= -->
<!-- My Appointments -->
<!-- ========================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-warning">
    <h5 class="mb-0">My Appointments</h5>
  </div>

  <div class="card-body">

    {% if appointments %}
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>Patient</th>
            <th>Contact</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
          </tr>
        </thead>

        <tbody>
          {% for appointment in appointments %}
          <tr>
            <td>
              {{ appointment.patient.first_name }}
              {{ appointment.patient.last_name }}
            </td>

            <td>
              {{ appointment.patient.contact }}
            </td>

            <td>
              {{ appointment.availability.date }}
            </td>

            <td>
              {{ appointment.availability.start_time }}
              -
              {{ appointment.availability.end_time }}
            </td>

            <td>
              <span class="badge bg-success">
                Booked
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-info mb-0 text-center">
        You have no appointments yet.
      </div>
    {% endif %}

  </div>
</div>


{% endblock %}
